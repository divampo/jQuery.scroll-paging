/**
 * jQuery.scroll-paging library v 0.8.2
 * https://github.com/divampo/jQuery.scroll-paging
 * https://bitbucket.org/divampo/jquery.scroll-paging
 * Copyright (c) 2013 Dmitry Serpakov
 * Licensed under the MIT license (http://www.opensource.org/licenses/mit-license.php)
 */
;(function(e){e.scrollPaging=function(t,n,r){this.$o=e(t),this.$container=e(n),this.options=e.extend(true,e.scrollPaging.defaults,r),this.last_scroll_position=null,this.cache_page=null,this.loading=0;this.options.offset=parseInt(this.options.offset,10);this._init()};e.scrollPaging.prototype.destroy=function(){var t=this;e(window).off("scroll",this.$o,function(){t._action()});e(window).unbind("load",function(){if(t.options.currentPage>t.options.startPage){t._loadPrev()}});for(var n in this.options.class){this.$container.find(this.options.items).removeClass(this.options.class[n])}e.removeData(this.$container.find(this.options.items),"page")};e.scrollPaging.prototype.refresh=function(){this.destroy();this._init()};e.scrollPaging.defaults={items:"> li",offset:50,startPage:1,currentPage:1,endPage:1,load:function(t,n){return e.Deferred(function(e){e.resolve(t,n)}).promise()},paging:function(e){},"class":{first:"first-scroll-item",last:"last-scroll-item",page:"page-scroll-item"}};e.scrollPaging.prototype._init=function(){if(this.options.startPage==this.options.endPage){return false}else if(this.options.startPage==this.options.currentPage){this.$container.find(this.options.items).first().addClass(this.options.class.first)}else if(this.options.currentPage>=this.options.endPage){this.$container.find(this.options.items).last().addClass(this.options.class.last)}this.$container.find(this.options.items).first().addClass(this.options.class.page).data("page",this.options.currentPage).attr("data-page",this.options.currentPage);this.$container.find(this.options.items).last().addClass(this.options.class.page).data("page",this.options.currentPage+1).attr("data-page",this.options.currentPage+1);var t=this;e(window).on("scroll",this.$o,function(){t._action()});e(window).bind("load",function(){if(t.options.currentPage>t.options.startPage){t._loadPrev()}})};e.scrollPaging.prototype._action=function(){var t=this,n=this._getDirection(),r=this.$container.find(this.options.items).last(),i=this.$container.find(this.options.items).first(),s=[];if(n==1&&!r.is("."+this.options.class.last)&&r.position().top+r.outerHeight()-this.options.offset<=e(window).scrollTop()+e(window).height()&&this.loading!=1){this._loadNext()}if(n==-1&&!i.is("."+this.options.class.first)&&i.position().top+i.outerHeight()+this.options.offset>e(window).scrollTop()&&this.loading!=1){this._loadPrev()}this.$container.find(this.options.items).filter("."+this.options.class.page).each(function(r,i){var o=e(i);if(n==1&&!o.is("."+t.options.class.last)&&o.position().top+o.outerHeight()<=e(window).scrollTop()+e(window).height()){s.push(parseInt(o.data("page"),10))}if(n==-1&&!o.is("."+t.options.class.first)&&o.position().top>=e(window).scrollTop()){s.push(parseInt(o.data("page"),10)-1)}});var o=null;if(s.length>0){if(n==1){o=Math.max.apply(null,s)}if(n==-1){o=Math.min.apply(null,s)}if(o!=this.cache_page){this.options.paging(o);this.cache_page=o}}};e.scrollPaging.prototype._loadNext=function(){var e=this,t=this.$container.find(this.options.items).last();this.loading=1;this.options.load(t.data("page"),"after").done(function(){if(t.data("page")>=e.options.endPage){e.$container.find(e.options.items).last().addClass(e.options.class.last)}e.$container.find(e.options.items).last().addClass(e.options.class.page).data("page",t.data("page")+1).attr("data-page",t.data("page")+1);e.loading=0}).fail(function(){e.$container.find(e.options.items).last().addClass(e.options.class.last).addClass(e.options.class.page).data("page",t.data("page")+1).attr("data-page",t.data("page")+1);e.options.endPage=t.data("page");e.loading=0})};e.scrollPaging.prototype._loadPrev=function(){var t=this,n=this.$container.find(this.options.items).first();var r=this.$container.outerHeight();this.loading=1;this.options.load(n.data("page")-1,"before").done(function(){if(n.data("page")-1<=t.options.startPage){t.$container.find(t.options.items).first().addClass(t.options.class.first)}t.$container.find(t.options.items).first().addClass(t.options.class.page).data("page",n.data("page")-1).attr("data-page",n.data("page")-1);e(window).scrollTop(e(window).scrollTop()+(t.$container.outerHeight()-r));t.loading=0}).fail(function(){t.$container.find(t.options.items).first().addClass(t.options.class.first).addClass(t.options.class.page).data("page",n.data("page")-1).attr("data-page",n.data("page")-1);t.options.startPage=n.data("page");t.loading=0})};e.scrollPaging.prototype._getDirection=function(){var e=0;if(this.last_scroll_position!=undefined){e=this.last_scroll_position>this.$o.scrollTop()?-1:1}this.last_scroll_position=this.$o.scrollTop();return e};e.fn.scrollPaging=function(t,n){return new e.scrollPaging(this,t,n)}})(jQuery);